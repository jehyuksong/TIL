# ì˜¤ëŠ˜ í•œ ì¼ğŸ”¥

- **ë””ë§ˆìœ ì €**ì˜ íšŒì›ê°€ì…ê³¼ ë¡œê·¸ì¸ì„ ê¸°ëŠ¥ì„ ë§Œë“¤ë©´ì„œ ê¸°ë³¸ì ìœ¼ë¡œ ì¸ì¦ê³¼ ì„¸ì…˜ì„ êµ¬í˜„í•˜ëŠ” ë¶€ë¶„ì—ì„œ ë§ì€ ì–´ë ¤ì›€ì„ ê²ªì—ˆë‹¤.
- íšŒì›ê°€ì…ê³¼ ë¡œê·¸ì¸ ë“±ì˜ ê¸°ëŠ¥ë“¤ì„ ë°”ë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆê²Œ ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ë¥¼ ë§Œë“¤ê³  ìˆë‹¤.

---

# ì˜¤ëŠ˜ ëŠë‚€ ì ğŸ”¥

- ë§Œë“¤ì–´ë³´ë©´ì„œ êµ‰ì¥íˆ ë¶€ì¡±í•˜ë‹¤ê³  ëŠê»´ì§„ ë¶€ë¶„ì´ ìˆì–´ì„œ ì°¾ì•„ê°€ë©´ì„œ í•˜ëŠ”ë°ë„ ì „í˜€ í•™ìŠµì— ë„ì›€ì´ ë˜ì§€ ì•Šê³ , ì½”ë“œë¥¼ ë³´ë©´ì„œë„ ì–´ë””ë¥¼ ìˆ˜ì •í•´ì•¼ í•  ì§€ ì–´ë””ê°€ ì˜ëª»ëœê±´ì§€ ì „í˜€ ì•Œ ìˆ˜ê°€ ì—†ì—ˆë‹¤. ê·¸ë˜ì„œ í† ì´í”„ë¡œì íŠ¸ë¥¼ ì ì‹œ ë©ˆì¶”ê³  í•™ìŠµì„ ë” ì´ì–´ê°€ê¸°ë¡œ í–ˆë‹¤.
- íšŒì›ê°€ì…ê³¼ ë¡œê·¸ì¸ ê¸°ëŠ¥ì´ ë„ˆë¬´ë„ˆë¬´ë„ˆë¬´ë„ˆë¬´ë„ˆë¬´ ë³µì¡í•´ì„œ ë¨¸ë¦¬ê°€ í„°ì§ˆ ê²ƒ ê°™ë‹¤........

---

# Boiler-Plate ë§Œë“¤ê¸°

- ëŒ€ë¶€ë¶„ì˜ ì›¹í˜ì´ì§€ë¥¼ ë§Œë“¤ ë•Œ **íšŒì›ê°€ì…**ì´ë‚˜ **ë¡œê·¸ì¸** ê¸°ëŠ¥ì€ ê±°ì˜ í•„ìˆ˜ì ìœ¼ë¡œ ë“¤ì–´ê°„ë‹¤. ì›¹í˜ì´ì§€ë¥¼ ë§Œë“¤ ë•Œë§ˆë‹¤ ë§Œë“œëŠ” ê²ƒì´ ë¹„íš¨ìœ¨ì ì´ê¸° ë•Œë¬¸ì— ì´ëŸ¬í•œ ë¶€ë¶„ë“¤ì˜ **í…œí”Œë¦¿**ì„ ë§Œë“¤ì–´ ë†“ëŠ” ê²ƒì´ë‹¤.
- Express ì„¤ì •ì„ í•´ì¤€ë‹¤.

### íšŒì›ê°€ì…í•˜ê¸°

- Mongoose userSchema, modelì„ User.jsë¡œ ë”°ë¡œ ë§Œë“¤ì–´ì„œ ëª¨ë“ˆë¡œ ë¶ˆëŸ¬ì„œ ì‚¬ìš©í•œë‹¤.

```jsx
const mongoose = require("mongoose");

const userSchema = mongoose.Schema({
  name: {
    type: String,
    maxlength: 50
  },
  email: {
    type: String,
    trim: true, // ìŠ¤í˜ì´ìŠ¤ë¥¼ ì—†ì• ì¤Œ
    unique: 1 // ê°™ì€ ì´ë©”ì¼ì€ ëª»ì“°ê²Œ í•´ì¤Œ
  },
  password: {
    type: String,
    minlength: 5
  },
  role: {
    type: Number,
    default: 0
  },
  image: String,
  token: {
    type: String
  },
  tokenExp: {
    type: Number
  }
});

const User = mongoose.model("User", userSchema);

module.exports = { User };
```

- Postmanì„ ì´ìš©í•´ì„œ íšŒì›ê°€ì… ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ë©´ì„œ í…ŒìŠ¤íŠ¸í–ˆë‹¤.
- **mongoURI** ê°€ ì í˜€ìˆëŠ” ë¶€ë¶„ì— ë¹„ë°€ì •ë³´ê°€ ìˆê¸° ë•Œë¬¸ì— config ë¼ëŠ” í´ë”ë¥¼ ë§Œë“¤ê³  ì•ˆì— key.js ,dev.js , prod.js ë¥¼ ë§Œë“ ë‹¤. ê·¸ë¦¬ê³  ê·¸ ì•ˆì— ë°°í¬ ì „ì¼ ë•ŒëŠ” dev.jsì— mongoURIë¥¼ ì ê³  ë°°í¬ ì´í›„ì¼ë•ŒëŠ” prod.jsì— ì ì–´ë†“ê³  ëª¨ë“ˆì„ exportsí•œë‹¤. ê·¸ë¦¬ê³  key.jsì—ëŠ”

```jsx
if (process.env.NODE_ENV === "production") {
  module.exports = require("./prod");
} else {
  module.exports = require("./dev");
}
```

- ì´ëŸ¬í•œ ì½”ë“œë¥¼ ì ì–´ì„œ ë°°í¬ ì´í›„ ìƒíƒœì¼ë•ŒëŠ” prodì—ì„œ ì´ì „ì¼ë•ŒëŠ” devì—ì„œ ê°€ì ¸ì™€ì„œ ì‚¬ìš©í•˜ê²Œë” ë§Œë“ ë‹¤.
- ê·¸ ë’¤ì— ì„œë²„íŒŒì¼ë¡œ ê°€ì„œ keyëª¨ë“ˆì„ ë¶ˆëŸ¬ì˜¤ê³  urië¥¼ ëŒ€ì²´í•´ì„œ ë„£ëŠ”ë‹¤.

### Bcryptë¡œ ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”í•˜ê¸°

```jsx
$ npm i bcrypt
```

```jsx
// User.jsì—ì„œ

const bcrypt = require("bcrypt");
const saltRounds = 10;

// íšŒì›ê°€ì…í•  ë•Œ save ì´ì „ì˜ ë‹¨ê³„ì—ì„œ ìˆ˜í–‰í•˜ê³  ì™„ë£Œì‹œ nextë¡œ ë‹¤ì‹œ ì§„í–‰ì„ ì´ì–´ê°€ê²Œë” í•¨
userSchema.pre("save", function (next) {
  const user = this;  // íšŒì›ê°€ì…ì¤‘ì¸ ëª¨ë¸ì„ ê°€ë¥´í‚´
	
	// ì´ë¦„ì„ ìˆ˜ì •í•  ë•Œë„ ì•”í˜¸í™”ë  ìˆ˜ë„ ìˆìœ¼ë‹ˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ìˆ˜ì •í•˜ê±°ë‚˜ ì…ë ¥í•  ë•Œë§Œ ì•”í˜¸í™”í•¨
  if (user.isModified("password")) {
    //ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”
    bcrypt.genSalt(saltRounds, function (err, salt) {
      if (err) return next(err);
      bcrypt.hash(user.password, salt, function (err, hash) {
        if (err) return next(err);
        user.password = hash;
        next();  // ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”ê°€ ëë‚˜ë©´ ë‹¤ì‹œ íšŒì›ê°€ì…í•˜ë˜ save ë‹¨ê³„ë¡œ ë„˜ì–´ê°.
      });
    });
  } else {
    next();    // ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•˜ê±°ë‚˜ ê°€ì…ì¤‘ì´ ì•„ë‹ ë•Œì—ëŠ” ì•”í˜¸í™”ì—†ì´ ê·¸ëƒ¥ ë‹¤ìŒ ë‹¨ê³„ë¡œ ë„˜ê¹€
  }
});
```

---

### ë¡œê·¸ì¸í•˜ê¸°

- **jsonwebtoken** ê³¼ **cookie-parser** ë¥¼ ì´ìš©í•´ì„œ ë¡œê·¸ì¸ì‹œ í™•ì¸í•˜ëŠ” í›„ì— í† í°ì„ ë¶€ì—¬í•œë‹¤.

```jsx
// ì„œë²„.js

const cookieParser = require("cookie-parser");

app.post("/login", function (req, res) {
  //ìš”ì²­ëœ ì´ë©”ì¼ì„ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ìˆëŠ”ì§€ ì°¾ëŠ”ë‹¤.
  User.findOne({ email: req.body.email }, (err, user) => {
    if (!user) {
      return res.json({
        loginSuccess: false,
        message: "ì…ë ¥í•˜ì‹  ì´ë©”ì¼ì— í•´ë‹¹í•˜ëŠ” ìœ ì €ê°€ ì—†ìŠµë‹ˆë‹¤."
      });
    }
    //ìš”ì²­ëœ ì´ë©”ì¼ì´ ë°ì´í„°ë² ì´ìŠ¤ì— ìˆë‹¤ë©´ ë¹„ë°€ë²ˆí˜¸ê°€ ë§ëŠ” ë¹„ë°€ë²ˆí˜¸ì¸ì§€ í™•ì¸í•œë‹¤.
    user.comparePassword(req.body.password, (err, isMatch) => {
      if (!isMatch) return res.json({ loginSuccess: false, message: "ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤." });

      //ë¹„ë°€ë²ˆí˜¸ê¹Œì§€ ë§ë‹¤ë©´ í† í°ì„ ìƒì„±í•œë‹¤.
      user.generateToken((err, user) => {
        if (err) return res.status(400).send(err);

        // í† í°ì„ ì¿ í‚¤ì— ì €ì¥í•œë‹¤.
        res.cookie("x_auth", user.token).status(200).json({ loginSuccess: true, userId: user._id });
      });
    });
  });
});
```

```jsx
// User.js

const jwt = require("jsonwebtoken");

userSchema.methods.comparePassword = function (plainPassword, cb) {
  bcrypt.compare(plainPassword, this.password, function (err, isMatch) {
    if (err) return cb(err), cb(null, isMatch);
  });
};

userSchema.methods.generateToken = function (cb) {
  const user = this;

  //jsonwebtokenì„ ì´ìš©í•´ì„œ token ìƒì„±í•˜ê¸°
  const token = jwt.sign(user._id.toHexString(), "secretToken");

  user.token = token;
  user.save(function (err, user) {
    if (err) return cb(err);
    cb(null, user);
  });
};
```
